<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>A.W.A.R.E - Waste Classifier</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Montserrat', Arial, sans-serif;
      background: #ebf6f5;
      color: #2c3e50;
      overflow-x: hidden;
    }

    h2 { margin-bottom: 1rem; color: #16a085; text-align: center; }

    button {
      background: #16a085;
      color: white;
      border: none;
      padding: 0.7rem 1.4rem;
      margin-top: 0.5rem;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s ease;
      display: inline-block;
    }
    button:hover { background: #13856e; }

    input, select, textarea {
      width: 100%;
      padding: 0.7rem;
      margin: 0.5rem 0;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
    }
    textarea { resize: vertical; }

    section {
      background: white;
      padding: 2rem;
      margin: 2rem auto;
      width: 90%;
      max-width: 800px;
      border-radius: 20px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.12);
      display: none;
      animation: fadeIn 0.4s ease;
    }
    section.active { display: block; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(10px);} to {opacity:1; transform:none;} }

    /* Sidebar */
    .hamburger { position: fixed; top: 1rem; left: 1rem; cursor: pointer; z-index: 1001; }
    .hamburger span { display:block; width:28px; height:3px; margin:5px; background:black; border-radius:5px; }

    .sidebar {
      position: fixed; left: -250px; top: 0; width: 250px; height: 100%;
      background: #16a085; padding-top: 3rem; transition: 0.3s; z-index: 1000; overflow-y: auto;
    }
    .sidebar.open { left: 0; }
    .sidebar ul { list-style: none; padding: 0; margin: 0; }
    .sidebar ul li { padding: 1rem 1.5rem; color: white; font-weight: 600; cursor: pointer; transition: background 0.3s; }
    .sidebar ul li:hover, .sidebar ul li.active { background: #13856e; }
    .sidebar ul ul { display: none; padding-left: 1rem; background: #1abc9c; }
    .sidebar ul ul li { font-weight: 500; }

    #userIndicator { padding: 1rem 1.2rem; font-weight: 600; color: #fff; background: rgba(0,0,0,0.15); border-bottom: 1px solid rgba(0,0,0,0.1); }

    .protected { display: none; }

    .main-content { margin: 2rem auto; max-width: 1000px; padding: 2rem; }
    .main-title { font-size: 2.2rem; text-align: center; font-weight: bold; color: #13856e; margin-bottom: 1.5rem; }

    #map { height: 400px; width: 100%; border-radius: 1rem; box-shadow: 0 5px 12px rgba(0,0,0,0.15); }

    .auth form { display:flex; flex-direction:column; gap:0.5rem; }
    .auth form button { margin-top:1rem; }

    @media (max-width: 768px) {
      .main-content { padding:1rem; }
      section { padding:1.2rem; margin:1.2rem auto; }
      .main-title { font-size: 1.7rem; }
    }

    /* Info page */
    .bin-info { display: grid; gap: 1.2rem; margin-top: 1.5rem; }
    .bin-card {
      display: flex; align-items: center; gap: 1rem;
      background: #fdfdfd; padding: 1rem 1.5rem;
      border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .bin-card img { width: 70px; height: 70px; object-fit: contain; }
    .bin-card:hover { transform: translateY(-4px); box-shadow: 0 6px 14px rgba(0,0,0,0.15); }
    .bin-card.highlight {
      transform: translateY(-4px);
      box-shadow: 0 8px 18px rgba(22,160,133,0.18);
      border-left-width: 12px !important;
    }
  </style>
</head>
<body>
  
<!-- Sidebar -->
<div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
<div class="sidebar" id="sidebar">
  <div id="userIndicator">Not logged in</div>
  <ul>
    <li onclick="showSection('home')">Home</li>
    <li id="featuresMenu" class="protected">Features
      <ul>
        <li class="protected" onclick="showSection('classifier')">AI Classifier</li>
        <li class="protected" onclick="showSection('guide')">Recycling Guide</li>
        <li class="protected" onclick="showSection('leaderboard')">Leaderboard</li>
      </ul>
    </li>
    <li id="loginMenu" onclick="showSection('Login')">Login</li>
    <li id="registerMenu" onclick="showSection('register')">Register</li>
    <li id="logoutMenu" style="display:none;" onclick="logoutUser()">Logout</li>
    <li class="protected" onclick="showSection('map-section')">Recycling Centers Map</li>
    <li onclick="showSection('information')">Information</li>
    <li onclick="showSection('about-us')">About Us</li>
    <li onclick="showSection('contact-us')">Contact Us</li>
  </ul>
</div>

<div class="main-content">
  <div class="main-title">A.W.A.R.E.</div>
    <section id="home" class="active">
      <h2>Welcome to A.W.A.R.E.</h2>
      <h3>♻️ Artificial Waste Analysis and Recycling Engine</h3>
      <p>AI-powered platform to classify waste, guide recycling, and locate recycling centers.</p>
    </section>

   <section id="classifier">
  <h2>AI Waste Classifier</h2>
  <input type="file" id="imageUpload" accept="image/*">
  <button id="classifyBtn">Classify Waste</button>
  <p id="result"></p>
  <p id="wasteType"></p>
  <p id="recyclingProcess"></p>
  <button id="viewBinBtn" style="display:none;" onclick="goToBinInfo()">View Bin Info</button>
</section>


    <section id="guide">
      <h2>Recycling Guide</h2>
      <input type="text" placeholder="Enter material..." onkeyup="searchMaterial(this.value)">
      <ul id="guideList"></ul>
    </section>

    <section id="register" class="auth">
      <h2>Register</h2>
      <form onsubmit="event.preventDefault(); registerUser();">
        <input type="text" id="regUsername" placeholder="Username" required />
        <input type="email" id="regEmail" placeholder="Email" required />
        <input type="password" id="regPassword" placeholder="Password" required />
        <button type="submit">Register</button>
      </form>
    </section>

    <section id="Login" class="auth">
      <h2>Login</h2>
      <form onsubmit="event.preventDefault(); loginUser();">
        <input type="text" id="loginUsername" placeholder="Username" required />
        <input type="password" id="loginPassword" placeholder="Password" required />
        <button type="submit">Login</button>
        <p style="text-align:center; margin-top:8px;">Don't have an account? <a href="#register" onclick="showSection('register')">Register</a></p>
      </form>
      <p id="loginStatus" style="text-align:center;"></p>
    </section>

    <section id="map-section">
      <h2>Nearby Recycling Centers</h2>
      <input type="text" id="locationSearch" placeholder="Enter city or area name">
      <button onclick="searchLocation()">Search Location</button>
      <label for="wasteFilter">Filter by Waste Type:</label>
      <select id="wasteFilter">
        <option value="general">General</option>
        <option value="Plastic Waste">Plastic Waste</option>
        <option value="Paper Waste">Paper Waste</option>
        <option value="Glass Waste">Glass Waste</option>
        <option value="Metal Waste">Metal Waste</option>
        <option value="E-Waste">E-Waste</option>
      </select>
      <div id="map"></div>
      <button onclick="findCenters()">Find Recycling Centers</button>
    </section>

   <section id="information">
    <h2>♻️ Dustbin Information Guide</h2>
    <p>Different colored bins are used for proper waste segregation. Here’s a quick guide:</p>
    <div class="bin-info">
      <div class="bin-card" style="border-left:8px solid blue;">
        <img src="{{ url_for('static', filename='images/blue-bin.png') }}" alt="Blue Bin">
        <div>
          <h3>Blue Bin – <span style="color:blue;">Recyclables</span></h3>
          <p>For <b>Plastic, Glass, Metal, and Paper</b> that can be recycled. Avoid food-stained or wet waste.</p>
        </div>
      </div>
      <div class="bin-card" style="border-left:8px solid green;">
        <img src="{{ url_for('static', filename='images/green-bin.png') }}" alt="Green Bin">
        <div>
          <h3>Green Bin – <span style="color:green;">Biodegradable Waste</span></h3>
          <p>For <b>Organic waste</b> like vegetable peels, food scraps, garden waste. Used for composting.</p>
        </div>
      </div>
      <div class="bin-card" style="border-left:8px solid black;">
        <img src="{{ url_for('static', filename='images/black-bin.png') }}" alt="Black Bin">
        <div>
          <h3>Black Bin – <span style="color:black;">Non-Recyclables</span></h3>
          <p>For <b>Domestic hazardous & non-recyclable items</b> like sanitary waste, dust, ceramics.</p>
        </div>
      </div>
      <div class="bin-card" style="border-left:8px solid red;">
        <img src="{{ url_for('static', filename='images/red-bin.png') }}" alt="Red Bin">
        <div>
          <h3>Red Bin – <span style="color:red;">E-Waste & Hazardous</span></h3>
          <p>For <b>Batteries, electronics, medical waste</b>. Should be sent to special facilities.</p>
        </div>
      </div>
      <div class="bin-card" style="border-left:8px solid brown;">
        <img src="{{ url_for('static', filename='images/brown-bin.png') }}" alt="Brown Bin">
        <div>
          <h3>Brown Bin – <span style="color:brown;">Organic Waste</span></h3>
          <p>For <b>Kitchen scraps</b>, used tea leaves, small amounts of garden waste. Ideal for composting at home.
          </p>
        </div>
      </div>
      <div class="bin-card" style="border-left:8px solid yellow;">
        <img src="{{ url_for('static', filename='images/yellow-bin.png') }}" alt="Yellow Bin">
        <div>
          <h3>Yellow Bin – <span style="color:goldenrod;">Metal Waste</span></h3>
          <p>For <b>Cans, foils, tins, and other metallic items</b> to be recycled separately.</p>
        </div>
      </div>
    </div>
  </section>
    </section>

     <section id="contact-us">
      <h2>Contact Us</h2>
      <p>Reach us at <strong>support@aware.com</strong></p>
      <form onsubmit="event.preventDefault(); alert('Message sent!');">
        <input type="text" placeholder="Name" required>
        <input type="email" placeholder="Email" required>
        <textarea placeholder="Message" required></textarea>
        <button type="submit">Send Message</button>
      </form>
    </section>
    <section id="leaderboard"><h2>Leaderboard</h2><p>Coming soon...</p></section>
   <section id="about-us">
      <h2>About Us</h2>
      <p> We are a group of eco-conscious developers using AI and data-driven tools to promote
        recycling, sustainable living, and environmental awareness. Our mission is to make it easy
        for everyone to understand how to manage waste, recyle them for making the future better .</p>
    </section>
</div>

<script>
const hamburger = document.getElementById("hamburger");
const sidebar = document.getElementById("sidebar");
const sections = document.querySelectorAll("section");
const menuItems = document.querySelectorAll(".sidebar ul li");
const userIndicator = document.getElementById("userIndicator") || null;

// ✅ Sidebar toggle
hamburger?.addEventListener("click", () => {
  sidebar.classList.toggle("open");
});

// ✅ Features dropdown toggle
const featuresMenu = document.getElementById("featuresMenu");
if (featuresMenu) {
  featuresMenu.addEventListener("click", e => {
    // Only toggle submenu, not switch section
    e.stopPropagation();
    const submenu = featuresMenu.querySelector("ul");
    if (submenu) {
      submenu.style.display = submenu.style.display === "block" ? "none" : "block";
    }
  });
}

function updateUserIndicator() {
  if (userIndicator)
    userIndicator.innerText = window.isLoggedIn
      ? `✅ Logged in: ${window.currentUsername}`
      : "❌ Not logged in";

  const loginMenu = document.getElementById("loginMenu");
  const registerMenu = document.getElementById("registerMenu");
  const logoutMenu = document.getElementById("logoutMenu");

  if (loginMenu) loginMenu.style.display = window.isLoggedIn ? "none" : "block";
  if (registerMenu) registerMenu.style.display = window.isLoggedIn ? "none" : "block";
  if (logoutMenu) logoutMenu.style.display = window.isLoggedIn ? "block" : "none";

  // ✅ Show protected only when logged in
  document.querySelectorAll(".protected").forEach(item => {
    item.style.display = window.isLoggedIn ? "block" : "none";
  });
}

function showSection(sectionId) {
  const protectedSections = ["classifier", "guide", "leaderboard", "map-section"];
  if (!window.isLoggedIn && protectedSections.includes(sectionId)) {
    alert("⚠️ Please log in to access this feature.");
    showSection("Login");
    return;
  }

  sections.forEach(sec => sec.classList.remove("active"));
  const el = document.getElementById(sectionId);
  if (el) el.classList.add("active");

  // highlight active menu item
  menuItems.forEach(item => item.classList.remove("active"));
  const activeItem = [...menuItems].find(li => li.getAttribute("onclick")?.includes(sectionId));
  if (activeItem) activeItem.classList.add("active");
}
// --- AUTH ---

function updateUserIndicator() {
  if (userIndicator) userIndicator.innerText = window.isLoggedIn ? `✅ Logged in: ${window.currentUsername}` : "❌ Not logged in";
  const loginMenu = document.getElementById("loginMenu");
  const registerMenu = document.getElementById("registerMenu");
  const logoutMenu = document.getElementById("logoutMenu");
  if (loginMenu) loginMenu.style.display = window.isLoggedIn ? "none" : "block";
  if (registerMenu) registerMenu.style.display = window.isLoggedIn ? "none" : "block";
  if (logoutMenu) logoutMenu.style.display = window.isLoggedIn ? "block" : "none";
  document.querySelectorAll(".protected").forEach(item => {
    item.style.display = window.isLoggedIn ? "block" : "none";
  });
}

function showSection(sectionId) {
  const protectedSections = ["classifier", "guide", "leaderboard", "map-section"];
  if (!window.isLoggedIn && protectedSections.includes(sectionId)) {
    alert("⚠️ Please log in to access this feature.");
    showSection("Login");
    return;
  }
  sections.forEach(sec => sec.classList.remove("active"));
  const el = document.getElementById(sectionId);
  if (el) el.classList.add("active");
  menuItems.forEach(item => item.classList.remove("active"));
  const activeItem = [...menuItems].find(li => li.getAttribute("onclick")?.includes(sectionId));
  if (activeItem) activeItem.classList.add("active");
}

// --- AUTH ---
async function registerUser() {
  const username = document.getElementById("regUsername").value;
  const email = document.getElementById("regEmail").value;
  const password = document.getElementById("regPassword").value;
  try {
    const res = await fetch("/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, email, password })
    });
    const data = await res.json();
    if (res.ok) {
      alert("✅ Registration successful. Please log in.");
      showSection("Login");
    } else alert("❌ " + (data.error || "Registration failed"));
  } catch (err) { alert("Error: " + err.message); }
}

async function loginUser() {
  const username = document.getElementById("loginUsername").value;
  const password = document.getElementById("loginPassword").value;
  try {
    const res = await fetch("/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password }),
      credentials: "include"
    });
    const data = await res.json();
    if (res.ok) {
      window.isLoggedIn = true;
      window.currentUsername = data.username;
      updateUserIndicator();
      alert("✅ Login successful!");
      showSection("home");
    } else alert("❌ " + (data.error || "Login failed"));
  } catch (err) { alert("Error: " + err.message); }
}

async function logoutUser() {
  try {
    await fetch("/logout", { method: "POST", credentials: "include" });
    window.isLoggedIn = false;
    window.currentUsername = "";
    updateUserIndicator();
    alert("✅ Logged out successfully");
    showSection("home");
  } catch (err) { alert("Error: " + err.message); }
}

async function checkAuth() {
  try {
    const res = await fetch("/check-auth", { credentials: "include" });
    const data = await res.json();
    if (res.ok && data.loggedIn) {
      window.isLoggedIn = true;
      window.currentUsername = data.username;
    } else {
      window.isLoggedIn = false;
      window.currentUsername = "";
    }
  } catch { window.isLoggedIn = false; }
  updateUserIndicator();
}
window.addEventListener("load", checkAuth);

// --- CLASSIFIER ---
let lastWasteType = "general";
async function classifyImage() {
  if (!window.isLoggedIn) { alert("⚠️ Please log in first."); showSection("Login"); return; }
  const fileInput = document.getElementById("imageUpload");
  const out = document.getElementById("result");
  const wasteType = document.getElementById("wasteType");
  const recyclingProcess = document.getElementById("recyclingProcess");
  const classifyBtn = document.getElementById("classifyBtn");
  if (!fileInput.files.length) { out.innerText = "Please upload an image."; return; }
  classifyBtn.disabled = true; classifyBtn.textContent = "Classifying...";
  out.innerText = "Classifying...";
  const formData = new FormData(); formData.append("file", fileInput.files[0]);
  try {
    const response = await fetch("/predict", { method: "POST", body: formData, credentials: "include" });
    const data = await response.json();
    if (response.ok) {
      out.innerHTML = `Detected Waste Category: <strong>${data.prediction}</strong>`;
      wasteType.innerHTML = `Waste Type: <strong>${data.waste_type}</strong>`;
      recyclingProcess.innerHTML = `Recycling Process: <strong>${data.recycling_process}</strong>`;
      lastWasteType = data.waste_type;
      highlightBin(data.dustbin);
    } else out.innerText = "Error: " + (data.error || "Failed");
  } catch (err) { out.innerText = "Error: " + err.message; }
  finally { classifyBtn.disabled = false; classifyBtn.textContent = "Classify Waste"; }
}
document.getElementById("classifyBtn")?.addEventListener("click", e => { e.preventDefault(); classifyImage(); });

let lastHighlightedBin = null;

function highlightBin(binName) {
  // Remove previous highlights
  document.querySelectorAll(".bin-card").forEach(card => card.classList.remove("highlight"));

  // Find target bin card by name
  let target = null;
  document.querySelectorAll(".bin-card h3").forEach(h3 => {
    if (h3.textContent.includes(binName)) {
      target = h3.closest(".bin-card");
    }
  });

  if (target) {
    target.classList.add("highlight");
    lastHighlightedBin = target;

    // ✅ Show "View Bin Info" button
    document.getElementById("viewBinBtn").style.display = "inline-block";
  }
}
function goToBinInfo() {
  if (lastHighlightedBin) {
    showSection("information");
    lastHighlightedBin.scrollIntoView({ behavior: "smooth", block: "center" });
  } else {
    alert("No bin info available yet. Please classify an image first.");
  }
}


  


// --- GUIDE ---
 function searchMaterial(query) {
      const guideList = document.getElementById("guideList");
      const tips = { plastic: "Recycle bottles", glass: "Separate by color", metal: "Aluminium is recyclable", organic: "Compostable", paper: "Recycle clean paper", battery: "Take to recycling center" };
      guideList.innerHTML = "";
      if (query.trim() !== "") Object.keys(tips).forEach(k => {
        if (k.includes(query.toLowerCase())) {
          let li = document.createElement("li");
          li.textContent = k.toUpperCase() + ": " + tips[k];
          guideList.appendChild(li);
        }
      });
    }
// --- MAP ---
var map = L.map('map').setView([20.5937, 78.9629], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap' }).addTo(map);
    let markers = [];
    function clearMarkers() { markers.forEach(m => map.removeLayer(m)); markers = []; }
    function addMarker(lat, lon, popup) { const m = L.marker([lat, lon]).addTo(map).bindPopup(popup); markers.push(m); }

    async function findCenters() {
      if (!window.isLoggedIn) { alert("Login to find centers."); showSection("Login"); return; }
      clearMarkers();
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async pos => {
          const { latitude, longitude } = pos.coords;
          map.setView([latitude, longitude], 13);
          addMarker(latitude, longitude, "📍 You are here");
          const filterType = document.getElementById("wasteFilter").value || lastWasteType;
          try {
            const res = await fetch(`/nearby?lat=${latitude}&lon=${longitude}&type=${encodeURIComponent(filterType)}`, { credentials: "include" });
            const data = await res.json();
            if (res.ok && data.centers) data.centers.forEach(c => addMarker(c.lat, c.lon, `<b>${c.name}</b><br>Type: ${c.type}`));
            else alert(data.error || "No centers found");
          } catch (err) { alert("Error: " + err.message); }
        });
      } else alert("Geolocation not supported by your browser.");
    }

    async function searchLocation() {
      const query = document.getElementById("locationSearch").value;
      if (!query.trim()) return;
      clearMarkers();
      try {
        const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
        const data = await res.json();
        if (data.length > 0) {
          const { lat, lon } = data[0];
          const latf = parseFloat(lat), lonf = parseFloat(lon);
          map.setView([latf, lonf], 13);
          addMarker(latf, lonf, `📍 ${query}`);
          if (!window.isLoggedIn) { alert("Log in to fetch recycling centers for this location."); showSection("Login"); return; }
          const res2 = await fetch(`/nearby?lat=${latf}&lon=${lonf}&type=${encodeURIComponent(document.getElementById("wasteFilter").value || "general")}`, { credentials: "include" });
          const data2 = await res2.json();
          if (res2.ok && data2.centers) data2.centers.forEach(c => addMarker(c.lat, c.lon, `<b>${c.name}</b><br>Type: ${c.type}`));
          else alert(data2.error || "No centers found");
        } else alert("Location not found");
      } catch (err) { alert("Geocoding error: " + err.message); }
    }
  </script>
</body>

</html>
