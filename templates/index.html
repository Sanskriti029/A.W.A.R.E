<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>A.W.A.R.E - Waste Classifier</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Montserrat', Arial, sans-serif;
      background: #ebf6f5;
      color: #2c3e50;
      overflow-x: hidden;
}
    h3{
      text-align: center; color: #16a085; margin-top: 1.5rem; font-weight: bold; font-size: 1.5rem;
    }

    h2 { margin-bottom: 1rem; color: #16a085; text-align: center;
      font-weight: bold; font-size: 1.5rem; 
   ;}
   
     
    button {
      background: #16a085;
      color: white;
      border: none;
      padding: 0.7rem 1.4rem;
      margin-top: 0.5rem;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s ease;
      display: inline-block;
    }
    button:hover { background: #13856e; }

    input, select, textarea {
      width: 100%;
      padding: 0.7rem;
      margin: 0.5rem 0;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
    }
    textarea { resize: vertical; }

    section {
      background: white;
      padding: 2rem;
      margin: 2rem auto;
      width: 90%;
      max-width: 800px;
      border-radius: 20px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.12);
      display: none;
      animation: fadeIn 0.4s ease;
    }
    section.active { display: block; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(10px);} to {opacity:1; transform:none;} }

    /* Sidebar */
    .hamburger { position: fixed; top: 1rem; left: 1rem; cursor: pointer; z-index: 1001; }
    .hamburger span { display:block; width:28px; height:3px; margin:5px; background:black; border-radius:5px; }



    
    .sidebar {
      position: fixed; left: -250px; top: 0; width: 250px; height: 100%;
      background: #16a085; padding-top: 3rem; transition: 0.3s; z-index: 1000; overflow-y: auto;
       display: none; /* ‚úÖ hide by default */
    }
    .sidebar.open { left: 0; }
    .sidebar ul { list-style: none; padding: 0; margin: 0; }
    .sidebar ul li {
      padding: 1rem 1.8rem;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .sidebar ul li:hover, .sidebar ul li.active {
      background: #13856e;
      padding-left: 2.1rem;
    }
    .sidebar ul ul { display: none; padding-left: 1rem; background: #1abc9c; }
    .sidebar ul ul li { font-weight: 500; }

    #userIndicator {
      padding: 1rem 1.2rem;
      font-weight: 600;
      color: #fff;
      background: rgba(0,0,0,0.15);
      border-bottom: 1px solid rgba(0,0,0,0.1);
      
    }
#userIndicator {
  display: none;
}

    .protected { display: none; }

    .main-content { margin: 2rem auto; max-width: 1000px; padding: 2rem; }
    .main-title { font-size: 2.2rem; text-align: center; font-weight: bold; color: #13856e; margin-bottom: 1.5rem; }

    #map { height: 400px; width: 100%; border-radius: 1rem; box-shadow: 0 5px 12px rgba(0,0,0,0.15); }

    .auth form { display:flex; flex-direction:column; gap:0.5rem; }
    .auth form button { margin-top:1rem; }

    @media (max-width: 768px) {
      .main-content { padding:1rem; }
      section { padding:1.2rem; margin:1.2rem auto; }
      .main-title { font-size: 1.7rem; }
    }

    /* Info page */
    .bin-info { display: grid; gap: 1.2rem; margin-top: 1.5rem; }
    .bin-card {
      display: flex; align-items: center; gap: 1rem;
      background: #fdfdfd; padding: 1rem 1.5rem;
      border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .bin-card img { width: 70px; height: 70px; object-fit: contain; }
    .bin-card:hover { transform: translateY(-4px); box-shadow: 0 6px 14px rgba(0,0,0,0.15); }
    .bin-card.highlight {
      transform: translateY(-4px);
      box-shadow: 0 8px 18px rgba(22,160,133,0.18);
      border-left-width: 12px !important;
    }

    /* Account dropdown */
    .account-dropdown {
      position: absolute;
      top: 1rem;
      right: 1.5rem;
    }
    .account-dropdown .dropdown-toggle {
      background: #16a085;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .account-dropdown .dropdown-menu {
      display: none;
      position: absolute;
      top: 120%;
      right: 0;
      background: white;
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      border-radius: 8px;
      list-style: none;
      margin: 0;
      padding: 0.5rem 0;
      min-width: 140px;
      z-index: 999;
    }
    .account-dropdown .dropdown-menu li {
      padding: 0.6rem 1rem;
      cursor: pointer;
    }
    .account-dropdown .dropdown-menu li:hover {
      background: #f4f4f4;
    }
 #accountIcon {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: #16a085;
  color: white;
  display: none; /* hidden until login */
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 16px;
  cursor: pointer;
  position: absolute;
  top: 1rem;
  right: 1.5rem;
}

/* Dropdown menu */
#accountDropdown {
  display: none;
  position: absolute;
  top: 3.5rem; /* below icon */
  right: 1.5rem;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 8px;
  list-style: none;
  padding: 0.5rem 0;
  margin: 0;
  min-width: 120px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  z-index: 1000;
}
.notifications-panel h4 {
  margin: 0 0 0.5rem 0;
  font-size: 20px;
  border-bottom: 1px solid #eee;
  padding-bottom: 0.3rem;
  display: none;
}

.notifications-panel ul {
  list-style: none;
  padding: 0;
  margin: 0;

}

.notifications-panel ul li {
  font-size: 13px;
  padding: 0.5rem 0;
  border-bottom: 1px solid #f1f1f1;
}
.notifications-panel ul li:last-child {
  border-bottom: none;
}
#accountDropdown li {
  padding: 0.5rem 1rem;
  cursor: pointer;
  font-size: 14px;
  color: #333;
}

#accountDropdown li:hover {
  background: #f5f5f5;
}
#accountIcon, #accountDropdown {
  display: none;
}

#leaderboard table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
}
#leaderboard th, #leaderboard td {
  padding: 0.8rem;
  border-bottom: 1px solid #ddd;
  text-align: center;
}
#leaderboard th {
  background-color: #16a085;
  color: white;
  border-radius: 6px;
}
#leaderboard tbody tr:hover {
  background-color: #f0f0f0;
}
/* üîî Toast notifications */
#toastContainer {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 2000;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.toast {
  background: #16a085;
  color: white;
  padding: 12px 18px;
  border-radius: 10px;
  font-size: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  opacity: 0;
  transform: translateX(100%);
  transition: all 0.4s ease;
  max-width: 300px;
}

.toast.show {
  opacity: 1;
  transform: translateX(0);
}

.toast.hide {
  opacity: 0;
  transform: translateX(100%);
}
/* Pulse animation for new notifications */
@keyframes pulse {
  0% { transform: scale(1); box-shadow: 0 0 0 rgba(22,160,133, 0.4); }
  50% { transform: scale(1.2); box-shadow: 0 0 10px rgba(22,160,133, 0.6); }
  100% { transform: scale(1); box-shadow: 0 0 0 rgba(22,160,133, 0.4); }
}

.pulse {
  animation: pulse 0.6s ease-in-out 2;
}
/* Modal background */
.modal {
  display: none; /* Hidden by default */
  position: fixed;
  z-index: 2000;
  left: 0; top: 0;
  width: 100%; height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.5);
  backdrop-filter: blur(2px);
}

/* Modal content box */
.modal-content {
  background: #fff;
  margin: 10% auto;
  padding: 20px;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  text-align: center;
  position: relative;
}

/* Close button */
.close-btn {
  position: absolute;
  top: 10px; right: 15px;
  font-size: 24px;
  font-weight: bold;
  color: #333;
  cursor: pointer;
}
.modal-content {
  background: #fff;
  margin: 10% auto;
  padding: 20px;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  text-align: center;
  position: relative;
  border-left: 8px solid #16a085; /* Default color, will override in JS */
}
.map-embed {
  margin: 1.5rem 0;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 6px 14px rgba(0,0,0,0.15);
}
.map-embed iframe {
  width: 100%;
  height: 450px;
  border: none;
  display: block;
}
/* Make <a> inside sidebar li look like li text */
.sidebar ul li a {
  color: white;
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  font-weight: 600;
}

.sidebar ul li a:hover {
  background: #13856e;
  padding-left: 2.1rem;
  border-radius: 4px;
}


  </style>
<body>
  <div id="appContainer" style="display:none;">
<!-- Sidebar -->
<div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
<div class="sidebar" id="sidebar">
  <div id="userIndicator">Not logged in</div>
  <ul>
    <li onclick="showSection('home')">üè† Home</li>
    <li id="featuresMenu" class="protected">‚ú® Features
      <ul>
        <li class="protected" onclick="showSection('classifier')">AI Classifier</li>
        <li class="protected" onclick="showSection('guide')">Recycling Guide</li>
        <li class="protected" onclick="showSection('leaderboard')">Leaderboard</li>
      </ul>
    </li>
    <li class="protected"><a href="/map"><span>üìñ</span>  Recycling Centers </a></li>

    <!-- <li class="protected" onclick="showSection('map-section')">üó∫ Map</li> -->
    <li class="protected" onclick="showSection('information')">‚ÑπÔ∏è Information</li>
    <li onclick="showSection('about-us')">üë• About Us</li>
    <li onclick="showSection('contact-us')">üì© Contact Us</li>
  </ul>
</div>

<div class="main-content">
  <div class="main-title">A.W.A.R.E.</div>

<div id="accountIcon"></div>
<ul id="accountDropdown" class="account-dropdown">
  <li id="notificationsBtn">Notifications</li>
  <li id="logoutBtn">Logout</li>
</ul>

<!-- Notifications Panel (hidden by default) -->
<div id="notificationsPanel" class="notifications-panel">
  <h4>Notifications</h4>
  <ul id="notificationsList"></ul>
</div>
<div id="toastContainer"></div>
</div>

<section id="home">
  <h2>Welcome to A.W.A.R.E.</h2>
  <h3>‚ôªÔ∏è Artificial Waste Analysis and Recycling Engine</h3>
  <p>AI-powered platform to classify waste, guide recycling, and locate recycling centers.</p>
</section>

<!-- Login (make this active by default) -->
 
<section id="Login" class="auth active">
  <h3>Welcome to A.W.A.R.E. <br>
 <h4>Login to your account.</h4>
 </h3>
  <h2>Login</h2>
  <form onsubmit="event.preventDefault(); loginUser();">
    <input type="text" id="loginUsername" placeholder="Username" required />
    <input type="password" id="loginPassword" placeholder="Password" required />
    <button type="submit">Login</button>
    <p style="text-align:center; margin-top:8px;">Don't have an account? <a href="#register" onclick="showSection('register')">Register</a></p>
    <p style="text-align:center; margin-top:8px;">
  <a href="#" id="forgotPasswordLink">Forgot Password?</a>
</p>

  </form>

  <p id="loginStatus" style="text-align:center;"></p>
</section>

<section id="forgotPassword" class="auth">
  <h2>Forgot Password</h2>
  <form onsubmit="event.preventDefault(); resetPassword();">
    <input type="email" id="fpEmail" placeholder="Enter your email" required />
    <input type="password" id="fpNewPassword" placeholder="Enter new password" required />
    <button type="submit">Reset Password</button>
    <p style="text-align:center; margin-top:8px;">
      Remembered your password? <a href="#" id="backToLoginLink">Login</a>
    </p>
  </form>
  <p id="fpStatus" style="text-align:center; color: red;"></p>
</section>

   <section id="classifier">
  <h2>AI Waste Classifier</h2>
  <input type="file" id="imageUpload" accept="image/*">
  <button id="classifyBtn">Classify Waste</button>
  <p id="result"></p>
  <p id="wasteType"></p>
  <p id="recyclingProcess"></p>
  <!-- Inside <section id="classifier"> -->
<!-- <button id="goToCentersBtn" style="margin-top:10px; background:#f39c12;">Find Recycling Centers</button> -->

  <button id="viewBinBtn" style="display:none;">View Bin Info</button>

  <!-- Bin Info Modal -->
  <div id="binInfoModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
       background: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:10000;">
    <div style="background:white; padding:2rem; border-radius:12px; max-width:400px; width:90%; position:relative;">
      <span id="closeBinModal" style="position:absolute; top:10px; right:15px; cursor:pointer; font-size:20px;">&times;</span>
      <h3 id="binModalTitle"></h3>
      <p id="binModalDesc"></p>
    </div>
  </div> 
</section>


    <section id="guide">
      <h2>Recycling Guide</h2>
      <input type="text" placeholder="Enter material..." onkeyup="searchMaterial(this.value)">
      <ul id="guideList"></ul>
    </section>

    <section id="register" class="auth">
      <h2>Register</h2>
      <form onsubmit="event.preventDefault(); registerUser();">
        <input type="text" id="regUsername" placeholder="Username" required />
        <input type="email" id="regEmail" placeholder="Email" required />
        <input type="password" id="regPassword" placeholder="Password" required />
        <button type="submit">Register</button>
   <p style="text-align:center; margin-top:8px;">
  Already have an account? 
  <a href="#" id="goToLoginLink">Login</a>
</p>



      </form>
    </section>

   <section id="leaderboard">
  <h2>üèÜ Leaderboard</h2>
  <table id="leaderboardTable">
    <thead>
      <tr>
        <th>Rank</th>
        <th>User</th>
        <th>Points</th>
        <th>Classifications</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>
    <!-- <section id="map-section">
      <h2>Nearby Recycling Centers</h2>
      <input type="text" id="locationSearch" placeholder="Enter city or area name">
      <button onclick="searchLocation()">Search Location</button>
      <label for="wasteFilter">Filter by Waste Type:</label>
      <select id="wasteFilter">
        <option value="general">General</option>
        <option value="Plastic Waste">Plastic Waste</option>
        <option value="Paper Waste">Paper Waste</option>
        <option value="Glass Waste">Glass Waste</option>
        <option value="Metal Waste">Metal Waste</option>
        <option value="E-Waste">E-Waste</option>
      </select>
      <div id="map"></div>
      <button onclick="findCenters()">Find Recycling Centers</button>
      
    </section> -->
<!-- <section id="map-section">
  <h2>Nearby Recycling Centers</h2>
  <input type="text" id="locationSearch" placeholder="Enter city or area name">
  <button onclick="searchLocation()">Search Location</button>
  <label for="wasteFilter">Filter by Waste Type:</label>
  <select id="wasteFilter">
    <option value="general">General</option>
    <option value="Plastic Waste">Plastic Waste</option>
    <option value="Paper Waste">Paper Waste</option>
    <option value="Glass Waste">Glass Waste</option>
    <option value="Metal Waste">Metal Waste</option>
    <option value="E-Waste">E-Waste</option>
  </select> -->

  <!-- ‚úÖ Google Maps Embed Only -->
  <!-- <div class="map-embed">
    <iframe 
      src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d234700.90002902807!2d77.24107900392008!3d23.199323871704177!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x397c428f8fd68fbd%3A0x2155716d572d4f8!2sBhopal%2C%20Madhya%20Pradesh!5e0!3m2!1sen!2sin!4v1758211734687!5m2!1sen!2sin" 
      width="100%" 
      height="450" 
      style="border:0;" 
      allowfullscreen 
      loading="lazy" 
      referrerpolicy="no-referrer-when-downgrade">
    </iframe>
  </div>
</section>-->

   <section id="information"> 
    <h2>‚ôªÔ∏è Dustbin Information Guide</h2>
    <p>Different colored bins are used for proper waste segregation. Here‚Äôs a quick guide:</p>
    <div class="bin-info">
      <div class="bin-card" style="border-left:8px solid blue;">
        <img src="{{ url_for('static', filename='images/blue-bin.png') }}" alt="Blue Bin">
        <div>
          <h3>Blue Bin ‚Äì <span style="color:blue;">Recyclables</span></h3>
          <p>For <b>Plastic, Glass, Metal, and Paper</b> that can be recycled. Avoid food-stained or wet waste.</p>
        </div>
      </div>
      <div class="bin-card" style="border-left:8px solid green;">
        <img src="{{ url_for('static', filename='images/green-bin.png') }}" alt="Green Bin">
        <div>
          <h3>Green Bin ‚Äì <span style="color:green;">Biodegradable Waste</span></h3>
          <p>For <b>Organic waste</b> like vegetable peels, food scraps, garden waste. Used for composting.</p>
        </div>
      </div>
      <div class="bin-card" style="border-left:8px solid black;">
        <img src="{{ url_for('static', filename='images/black-bin.png') }}" alt="Black Bin">
        <div>
          <h3>Black Bin ‚Äì <span style="color:black;">Non-Recyclables</span></h3>
          <p>For <b>Domestic hazardous & non-recyclable items</b> like sanitary waste, dust, ceramics.</p>
        </div>
      </div>
      <div class="bin-card" style="border-left:8px solid red;">
        <img src="{{ url_for('static', filename='images/red-bin.png') }}" alt="Red Bin">
        <div>
          <h3>Red Bin ‚Äì <span style="color:red;">E-Waste & Hazardous</span></h3>
          <p>For <b>Batteries, electronics, medical waste</b>. Should be sent to special facilities.</p>
        </div>
      </div>
      <div class="bin-card" style="border-left:8px solid brown;">
        <img src="{{ url_for('static', filename='images/brown-bin.png') }}" alt="Brown Bin">
        <div>
          <h3>Brown Bin ‚Äì <span style="color:brown;">Organic Waste</span></h3>
          <p>For <b>Kitchen scraps</b>, used tea leaves, small amounts of garden waste. Ideal for composting at home.
          </p>
        </div>
      </div>
      <div class="bin-card" style="border-left:8px solid yellow;">
        <img src="{{ url_for('static', filename='images/yellow-bin.png') }}" alt="Yellow Bin">
        <div>
          <h3>Yellow Bin ‚Äì <span style="color:goldenrod;">Metal Waste</span></h3>
          <p>For <b>Cans, foils, tins, and other metallic items</b> to be recycled separately.</p>
        </div>
      </div>
    </div>
  </section>
    </section>

      <section id="contact-us">
    <h2>Contact Us</h2>
    <p>Reach us at <strong>aware.sup@gmail.com</strong></p>

    <!-- Add class gform and action to handle form submission -->
    <form class="gform" method="POST" data-sheet="responses" action="https://script.google.com/macros/s/AKfycbwVLsXcGO8gkVYlv3jzGHZahc-e_pNwiuijgBEX1F0HD1fwhRMGK2Am9w9cfAeYFQAT/exec">
      <div class="form-elements">
        <input type="text" name="name" placeholder="Name" required>
        <input type="email" name="email" placeholder="Email" required>
        <textarea name="message" placeholder="Message" required></textarea>
        <button type="submit">Send Message</button>
      </div>

     
    </form>
  </section>
    <!-- Removed duplicate leaderboard section to fix id conflict -->
   <section id="about-us">
      <h2>About Us</h2>
      <p> We are a group of eco-conscious developers using AI and data-driven tools to promote
        recycling, sustainable living, and environmental awareness. Our mission is to make it easy
        for everyone to understand how to manage waste, recyle them for making the future better .</p>
    </section>
</div>
<!-- Bin Info Modal -->
<div id="binModal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <div id="binModalContent"></div>
  </div>
</div>


<script>
  const wasteFacts = [
  "‚ôªÔ∏è Recycling one aluminum can saves enough energy to run a TV for 3 hours.",
  "üåç Plastic takes up to 500 years to decompose in landfills.",
  "üçå Food waste makes up almost 20% of landfills globally.",
  "üìÑ Recycling one ton of paper saves 17 trees.",
  "üîã Batteries should never go in general waste ‚Äî they can leak harmful chemicals.",
  "ü™ü Glass is 100% recyclable and can be recycled endlessly without loss of quality.",
  "Waste isn‚Äôt waste until we waste it. ‚Äì Unknown",
  "The greatest threat to our planet is the belief that someone else will save it.‚Äù ‚Äì Robert Swan",
  "We do not inherit the Earth from our ancestors; we borrow it from our children.‚Äù ‚Äì Native American Proverb",
"When you refuse to reuse, it‚Äôs the Earth you abuse. ‚Äì Unknown",
 "The Earth is what we all have in common. ‚Äì Wendell Berry",
"Less pollution is the best solution. ‚Äì Unknown",
"Recycling turns things into other things. Which is like magic. ‚Äì Unknown",
"Nature provides a free lunch, but only if we control our appetites. ‚Äì William Ruckelshaus",
"There is no such thing as ‚Äòaway‚Äô. When we throw anything away, it must go somewhere. ‚Äì Annie Leonard",
"Small acts, when multiplied by millions of people, can transform the world. ‚Äì Howard Zinn",
 "The world generates over 2.1 billion tons of municipal solid waste annually (World Bank, 2022).",
 "At least 33% of waste globally is not managed in an environmentally safe way.",
"Glass::Like aluminum, glass is 100% recyclable and can be recycled endlessly without any loss of quality.",
"Slow to Decompose: A modern glass bottle would take at least 4,000 years to decompose in a landfill.",
"Energy and Pollution Reduction: Recycling glass saves 20% less air pollution and 50% less water pollution compared to making new glass from raw materials.",
"Ancient Roots: Recycling isn't a modern invention. The first documented instance of paper recycling took place in Japan in the year 1031.",
"A 'Seventh Resource': Recycling is sometimes called the world's 'Seventh Resource' because it's a crucial component of sustainable resource management.",
"Most Waste is Recyclable: It's estimated that around 75% of all waste can be recycled, even though current recycling rates are much lower.",
"Recycling Saves Energy: Making new products from recycled materials almost always uses less energy than creating them from raw, 'virgin',materials.",
"Job Creation: The recycling industry creates jobs. A study by the Natural Resources Defense Council found that managing 1,000 tons of waste through recycling creates significantly more jobs than landfilling the same amount."
];

const binColors = {
  plastic: "Blue Bin",
  paper: "Blue Bin",
  glass: "Blue Bin",
  organic: "Green Bin",
  "e-waste": "Red Bin",
  hazardous: "Red Bin",
  metal: "Yellow Bin",
  general: "Black Bin"
};
let lastWasteType = "";
let lastHighlightedBin = null;


// Duplicate immediate classification block removed because it used top-level await and had an unmatched closing.
// Classification is handled via the classifyImage() async function and its event listeners defined later.

// Highlight bin
function highlightBin(binName) {
  document.querySelectorAll(".bin-card").forEach(card => card.classList.remove("highlight"));
  let target = null;
  document.querySelectorAll(".bin-card h3").forEach(h3 => {
    if (h3.textContent.includes(binName)) target = h3.closest(".bin-card");
  });

  if (target) {
    target.classList.add("highlight");
    lastHighlightedBin = target;
    document.getElementById("viewBinBtn").style.display = "inline-block";
  }
}

// Modal logic
const binInfoModal = document.getElementById("binInfoModal");
const binModalTitle = document.getElementById("binModalTitle");
const binModalDesc = document.getElementById("binModalDesc");
const closeBinModal = document.getElementById("closeBinModal");

document.getElementById("viewBinBtn").addEventListener("click", () => {
  // if (!lastHighlightedBin) return alert("No bin selected!");
  binModalTitle.innerHTML = lastHighlightedBin.querySelector("h3").innerHTML;
  binModalDesc.innerHTML = lastHighlightedBin.querySelector("p").innerHTML;
  binInfoModal.style.display = "flex";
});

closeBinModal.addEventListener("click", () => { binInfoModal.style.display = "none"; });
window.addEventListener("click", (e) => { if (e.target === binInfoModal) binInfoModal.style.display = "none"; });

  // let lastWasteType = null;
// ‚úÖ Sidebar toggle
const hamburger = document.getElementById("hamburger");
const sidebar = document.getElementById("sidebar");
hamburger?.addEventListener("click", () => sidebar.classList.toggle("open"));

// ‚úÖ Sections and menu items
const sections = document.querySelectorAll("section");
const menuItems = document.querySelectorAll(".sidebar ul li");

// ‚úÖ Account icon (initial only after login)
function updateAccountIcon() {
  const accountIcon = document.getElementById("accountIcon");
  if (!accountIcon) return;

  if (window.isLoggedIn && window.currentUsername) {
    const initial = window.currentUsername.charAt(0).toUpperCase();
    accountIcon.textContent = initial;
    accountIcon.style.display = "flex"; // show after login
  } else {
    accountIcon.style.display = "none"; // hide when logged out
  }
}



// ‚úÖ Allow logout by clicking the account icon
const accountIcon = document.getElementById("accountIcon");
const accountDropdown = document.getElementById("accountDropdown");
const logoutBtn = document.getElementById("logoutBtn");
const notificationsBtn = document.getElementById("notificationsBtn");
const notificationsPanel = document.getElementById("notificationsPanel");
const notificationsList = document.getElementById("notificationsList");

// Toggle dropdown
accountIcon?.addEventListener("click", (e) => {
  e.stopPropagation();
  accountDropdown.style.display = accountDropdown.style.display === "block" ? "none" : "block";
});

// Hide dropdown and notifications when clicking outside
document.addEventListener("click", () => {
  accountDropdown.style.display = "none";
  notificationsPanel.style.display = "none";
});

// Logout
logoutBtn?.addEventListener("click", () => {
  logoutUser();
  accountDropdown.style.display = "none";
});

// Notifications toggle
notificationsBtn?.addEventListener("click", (e) => {
  e.stopPropagation();
  notificationsPanel.style.display = notificationsPanel.style.display === "block" ? "none" : "block";
});
function showToast(message) {
  const container = document.getElementById("toastContainer");
  const toast = document.createElement("div");
  toast.className = "toast";
  toast.textContent = message;

  container.appendChild(toast);

  // Animate in
  setTimeout(() => toast.classList.add("show"), 100);

  // Auto remove after 4s
  setTimeout(() => {
    toast.classList.remove("show");
    toast.classList.add("hide");
    setTimeout(() => toast.remove(), 400);
  }, 4000);
}

// Example: Load sample notifications (replace with API later)
function addNotification(message) {
  const li = document.createElement("li");
  li.textContent = message;
  notificationsList.prepend(li); // newest on top

  // Show toast
  showToast(message);

  // Pulse the account icon to indicate new notification
  const accountIcon = document.getElementById("accountIcon");
  if (accountIcon) {
    accountIcon.classList.add("pulse");

    // Remove pulse class after animation ends to allow future pulses
    setTimeout(() => accountIcon.classList.remove("pulse"), 1200); // matches 0.6s x2
  }
}



// Load notifications when user logs in
function updateUserIndicator() {
  const userIndicator = document.getElementById("userIndicator");

  if (window.isLoggedIn && window.currentUsername) {
    userIndicator.innerText = `‚úÖ Logged in: ${window.currentUsername}`;

    // Show sidebar + toggle
    sidebar.style.display = "block";
    hamburger.style.display = "block";

    // Show protected items
    document.querySelectorAll(".protected").forEach(item => {
      item.style.display = "block";
    });
  } else {
    userIndicator.innerText = "‚ùå Not logged in";

    // Hide sidebar + toggle
    sidebar.style.display = "none";
    hamburger.style.display = "none";

    // Hide protected items
    document.querySelectorAll(".protected").forEach(item => {
      item.style.display = "none";
    });
  }

  updateAccountIcon(); // update the initial letter icon
}
  

// ‚úÖ Features dropdown toggle (for "Features" inside sidebar)
const featuresMenu = document.getElementById("featuresMenu");
if (featuresMenu) {
  const submenu = featuresMenu.querySelector("ul");
  featuresMenu.addEventListener("click", (e) => {
    e.stopPropagation();
    if (submenu) {
      submenu.style.display = submenu.style.display === "block" ? "none" : "block";
    }
  });
  if (submenu) {
    submenu.querySelectorAll("li").forEach((li) => {
      li.addEventListener("click", () => { submenu.style.display = "none"; });
    });
  }
}

// ‚úÖ Section switching
function showSection(sectionId) {
  const protectedSections = ["classifier", "guide", "leaderboard", "map-section"];

  if (!window.isLoggedIn && protectedSections.includes(sectionId)) {
    alert("‚ö†Ô∏è Please log in to access this feature.");
    sections.forEach(sec => sec.classList.remove("active"));
    document.getElementById("Login")?.classList.add("active");

    menuItems.forEach(item => item.classList.remove("active"));
    return;
  }

  sections.forEach(sec => sec.classList.remove("active"));
  const el = document.getElementById(sectionId);
  if (el) el.classList.add("active");

  menuItems.forEach(item => item.classList.remove("active"));
  const activeItem = [...menuItems].find(li => li.getAttribute("onclick")?.includes(sectionId));
  if (activeItem) activeItem.classList.add("active");

  // ‚úÖ Load leaderboard when the section is active
  if (sectionId === "leaderboard") loadLeaderboard();
}

// --- AUTH ---
async function registerUser() {
  const username = document.getElementById("regUsername").value;
  const email = document.getElementById("regEmail").value;
  const password = document.getElementById("regPassword").value;
  try {
    const res = await fetch("/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, email, password })
    });
    const data = await res.json();
    if (res.ok) {
      alert("‚úÖ Registration successful! Please log in.");
      showSection("Login");
    } else alert("‚ùå " + (data.error || "Registration failed"));
  } catch (err) { alert("Error: " + err.message); }

}



async function loginUser() {
  const username = document.getElementById("loginUsername").value;
  const password = document.getElementById("loginPassword").value;
  try {
    const res = await fetch("/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password }),
      credentials: "include"
    });
    const data = await res.json();
    if (res.ok) {
      window.isLoggedIn = true;
      window.currentUsername = data.username;
      updateUserIndicator();
      showSection("home");
      document.getElementById("sidebar").classList.add("open");

       // ‚úÖ Add login notification
      addNotification(`Welcome back, ${window.currentUsername}! üéâ`);

      // ‚úÖ Start waste fact notifications
      startWasteFactNotifications(30000); // every 30s

    } else alert("‚ùå " + (data.error || "Login failed"));
  } catch (err) { alert("Error: " + err.message); }
}

async function logoutUser() {
  try {
    const res = await fetch("/logout", { method: "POST", credentials: "include" });
    if (res.ok) {
      window.isLoggedIn = false;
      window.currentUsername = "";
      updateUserIndicator();

      sidebar.classList.remove("open");
      sidebar.style.display = "none";
      showSection("Login");
    } else {
      alert("‚ùå Logout failed");
    }
  } catch (err) {
    alert("Error: " + err.message);
  }
}

async function checkAuth() {
  try {
    const res = await fetch("/check-auth", { credentials: "include" });
    const data = await res.json();
    if (res.ok && data.loggedIn) {
      window.isLoggedIn = true;
      window.currentUsername = data.username;
      showSection("home");
    } else {
      window.isLoggedIn = false;
      window.currentUsername = "";
      showSection("Login");
    }
  } catch {
    window.isLoggedIn = false;
    showSection("Login");
  }
  updateUserIndicator();
}

window.addEventListener("load", async () => {
  await checkAuth(); // sets window.isLoggedIn and currentUsername
  document.getElementById("appContainer").style.display = "block"; // show content only after auth check
});
// "Already have an account? Login" link in register section
const goToLoginLink = document.getElementById("goToLoginLink");
if (goToLoginLink) {
  goToLoginLink.addEventListener("click", (e) => {
    e.preventDefault();
    showSection("Login"); // Use your existing section toggle function
  });
}

// Show Forgot Password section
const forgotPasswordLink = document.getElementById("forgotPasswordLink");
const backToLoginLink = document.getElementById("backToLoginLink");

if (forgotPasswordLink) {
  forgotPasswordLink.addEventListener("click", (e) => {
    e.preventDefault();
    showSection("forgotPassword");
  });
}

if (backToLoginLink) {
  backToLoginLink.addEventListener("click", (e) => {
    e.preventDefault();
    showSection("Login");
  });
}



async function resetPassword() {
  const email = document.getElementById("fpEmail").value;
  const newPassword = document.getElementById("fpNewPassword").value;
  const status = document.getElementById("fpStatus");

  try {
    const res = await fetch("/reset-password", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, newPassword }),
      credentials: "include"
    });
    const data = await res.json();

    if (res.ok) {
      status.style.color = "green";
      status.innerText = "‚úÖ Password reset successfully! Please login.";
      setTimeout(() => showSection("Login"), 2000);
    } else {
      status.style.color = "red";
      status.innerText = "‚ùå " + (data.error || "Failed to reset password");
    }
  } catch (err) {
    status.style.color = "red";
    status.innerText = "Error: " + err.message;
  }
}



// --- GUIDE ---
function searchMaterial(query) {
  const guideList = document.getElementById("guideList");
  const tips = { plastic: "Recycle bottles", glass: "Separate by color", metal: "Aluminium is recyclable", organic: "Compostable", paper: "Recycle clean paper", battery: "Take to recycling center", organic: "Plant and animal materials that can decompose.", recyclable: "Materials that can be reprocessed into new products.", hazardous: "Dangerous, toxic materials like batteries and chemicals." };


  guideList.innerHTML = "";
  if (query.trim() !== "") Object.keys(tips).forEach(k => {
    if (k.includes(query.toLowerCase())) {
      let li = document.createElement("li");
      li.textContent = k.toUpperCase() + ": " + tips[k];
      guideList.appendChild(li);
    }
  });
}

// --- MAP ---


//======================//
//classsifier
// Global



// let lastWasteType = "general";
async function classifyImage() {
  if (!window.isLoggedIn) { 
    alert("‚ö†Ô∏è Please log in first."); 
    showSection("Login"); 
    return; 
  }

  const fileInput = document.getElementById("imageUpload");
  const out = document.getElementById("result");
  const wasteType = document.getElementById("wasteType");
  const recyclingProcess = document.getElementById("recyclingProcess");
  const classifyBtn = document.getElementById("classifyBtn");

  if (!fileInput.files.length) { 
    out.innerText = "Please upload an image."; 
    return; 
  }

  classifyBtn.disabled = true; 
  classifyBtn.textContent = "Classifying...";
  out.innerText = "Classifying...";

  const formData = new FormData(); 
  formData.append("file", fileInput.files[0]);

  try {
    const response = await fetch("/predict", { method: "POST", body: formData, credentials: "include" });
    const data = await response.json();

    if (response.ok) {
      out.innerHTML = `Detected Waste Category: <strong>${data.prediction}</strong>`;
      wasteType.innerHTML = `Waste Type: <strong>${data.waste_type}</strong>`;

      // üîë Get bin color instead of recycling process
     // const binName = data.dustbin?.toLowerCase() || "general";
     // const binColor = binColors[binName] || "Black Bin";

      //recyclingProcess.innerHTML = `Recycling Process: <strong>Recycle in ${binColor}</strong>`;

      lastWasteType = (typeof data.waste_type === "string" && data.waste_type.trim() !== "") ? data.waste_type : "general";

      highlightBin(data.dustbin);

      // üîî Add notification with random waste fact
      const randomFact = wasteFacts[Math.floor(Math.random() * wasteFacts.length)];
      addNotification(randomFact);

    } else {
      out.innerText = "Error: " + (data.error || "Failed");
      highlightBin(null);
    }
  } catch (err) {
    out.innerText = "Error: " + err.message;
    highlightBin(null);
  } finally { 
    classifyBtn.disabled = false; 
    classifyBtn.textContent = "Classify Waste"; 
  }
}
function handleClassifyBtnClick(e) {
  if (e) e.preventDefault();
  classifyImage();
}

function highlightBin(binName) {
  document.querySelectorAll(".bin-card").forEach(card => card.classList.remove("highlight"));
  let target = null;
  document.querySelectorAll(".bin-card h3").forEach(h3 => {
    if (binName && h3.textContent.toLowerCase().includes(binName.toLowerCase())) {
      target = h3.closest(".bin-card");
    }
  });
  if (target) {
    target.classList.add("highlight");
    document.getElementById("viewBinBtn").style.display = "inline-block";
  } else {
    document.getElementById("viewBinBtn").style.display = "none";
  }
}
// / Attach event listener to classify button
document.getElementById("classifyBtn")?.addEventListener("click", handleClassifyBtnClick);

const binModal = document.getElementById("binModal");
const binModalContent = document.getElementById("binModalContent");
const binCloseBtn = document.querySelector(".close-btn");

function goToBinInfo() {
  if (!lastWasteType) {
    binModalContent.innerHTML = `
      <h2 style="color:#555;">No Classification Yet</h2>
      <p>Please classify an item first to see detailed bin information.</p>
    `;
    binModal.style.display = "block";
    return;
  }

  // ‚úÖ Map waste type ‚Üí bin
  const typeToBin = {
    "plastic waste": "Blue Bin",
    "paper waste": "Blue Bin",
    "glass waste": "Blue Bin",
    "metal waste": "Yellow Bin",
    "organic waste": "Green Bin",
    "e-waste": "Red Bin",
    "hazardous waste": "Red Bin",
    "general": "Black Bin"
  };

  const binName = typeToBin[lastWasteType.toLowerCase()] || null;

  let targetBin = null;
  if (binName) {
    document.querySelectorAll(".bin-card").forEach(card => {
      if (card.querySelector("h3").textContent.includes(binName)) {
        targetBin = card;
      }
    });
  }

  if (!targetBin) {
    binModalContent.innerHTML = `
      <h2 style="color:#e74c3c;">Oops!</h2>
      <p>No bin information found for <strong>${lastWasteType}</strong>.</p>
    `;
    binModal.style.display = "block";
    return;
  }

  // Extract bin info
  const borderColor = targetBin.style.borderLeftColor || getComputedStyle(targetBin).borderLeftColor || "#16a085";
  const title = targetBin.querySelector("h3").textContent;
  const description = targetBin.querySelector("p").textContent;
  const imgSrc = targetBin.querySelector("img")?.src || "";

  // Build modal content
  binModalContent.innerHTML = `
    <h2 style="color:${borderColor}; margin-bottom:10px;">${title}</h2>
    <img src="${imgSrc}" alt="${title}" style="width:80px; margin:10px 0;">
    <p>${description}</p>
    <p style="margin-top:15px; font-weight:bold; color:${borderColor};">
      ‚úÖ Please use the <span style="text-transform:capitalize;">${title}</span> for recycling.
    </p>
  `;

  binModal.style.display = "block";
}


// Close modal on X click
if (binCloseBtn) binCloseBtn.onclick = () => binModal.style.display = "none";

// Close modal on outside click
window.addEventListener("click", (event) => {
  if (event.target === binModal) binModal.style.display = "none";
});

document.getElementById("viewBinBtn")?.addEventListener("click", goToBinInfo);
//============================//
//leaderboard
async function loadLeaderboard() {
  const tbody = document.getElementById("leaderboardTable").querySelector("tbody");
  tbody.innerHTML = "<tr><td colspan='4'>Loading...</td></tr>";

  try {
    const res = await fetch("/api/leaderboard", { credentials: "include" });
    const data = await res.json();
    tbody.innerHTML = "";
    data.forEach(user => {
      const row = `<tr>
                     <td>${user.rank}</td>
                     <td>${user.username}</td>
                     <td>${user.points}</td>
                     <td>${user.correct_classifications}</td>
                   </tr>`;
      tbody.innerHTML += row;
    });
  } catch(err) {
    tbody.innerHTML = `<tr><td colspan='4'>Error loading leaderboard</td></tr>`;
  }
}

// Call this when user opens leaderboard section
document.querySelector("li[onclick*='leaderboard']").addEventListener("click", loadLeaderboard);
function calculatePoints(wasteType) {
    switch(wasteType.toLowerCase()) {
        case "plastic waste": return 10;
        case "paper waste": return 10;
        case "organic waste": return 5;
        case "e-waste": return 20;
        case "hazardous waste": return 20;
        default: return 5;
    }
}

// Call backend to update points after classification
async function updatePointsBackend(username, wasteType) {
    const points = calculatePoints(wasteType);
    await fetch("/api/update-score", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, points }),
        credentials: "include"
    });
}


// Function to show a random waste fact every interval
function startWasteFactNotifications(interval = 30000) { // 30,000ms = 30s
  setInterval(() => {
    const randomFact = wasteFacts[Math.floor(Math.random() * wasteFacts.length)];
    addNotification(randomFact);
  }, interval);
}

// Call this after user logs in
window.addEventListener("load", () => {
  if (window.isLoggedIn) {
    startWasteFactNotifications(30000); // every 30s
  }
});


document.getElementById("goToCentersBtn").addEventListener("click", () => {
  if (!window.isLoggedIn) {
    alert("‚ö†Ô∏è Please log in first to access recycling centers.");
    showSection("Login");
    return;
  }

  // Redirect to the map section
  // showSection("map-section");
 window.location.href = "/api/recycling-centers";
  // Optional: focus on last classified waste type in filter
  const wasteFilter = document.getElementById("wasteFilter");
  if (lastWasteType) {
    wasteFilter.value = lastWasteType;
  }

  // Optionally, trigger finding centers automatically
  findCenters();
});

</script>
<script src="https://script.google.com/macros/s/AKfycbwVLsXcGO8gkVYlv3jzGHZahc-e_pNwiuijgBEX1F0HD1fwhRMGK2Am9w9cfAeYFQAT/exec"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-G9QM9CXG0L');
  </script>
  <script>
    function doPost(e) {
  try {
    // Open the Google Sheet using its ID
    var ss = SpreadsheetApp.openById("YOUR_SHEET_ID"); // replace with your Sheet ID
    var sheet = ss.getSheetByName("responses"); // make sure this matches your form's data-sheet

    // Parse the form data
    var params = e.parameter;
    var headers = Object.keys(params);
    
    // If the sheet is empty, add headers
    if(sheet.getLastRow() === 0){
      sheet.appendRow(headers);
    }

    // Add the form submission as a new row
    var row = headers.map(function(header){
      return params[header];
    });
    sheet.appendRow(row);

    // Return a success response
    return ContentService.createTextOutput(JSON.stringify({"result":"success"}))
      .setMimeType(ContentService.MimeType.JSON);

  } catch(error) {
    return ContentService.createTextOutput(JSON.stringify({"result":"error","error":error}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

  </script>



</body>
</html>
